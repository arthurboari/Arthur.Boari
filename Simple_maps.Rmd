---
title: "Simple Maps"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: true
      smooth_scroll: true
---

```{=html}
<style>
body {
  color: black;
  font-family: Times;
  font-size: 20px;
  text-align: justify;
  text-justify: inter-word;
}
pre {
  background-color: lightgreen;
}
#TOC {
  color: darkblue;
  font-family: Times;
  font-size: 14px;
  border-color: black;
}
#header {
  color: gold;
}
</style>
```

The following content was prepared as a part of an assignment for the PEA-504 - Estágio em Docência (*"Internship in Teaching"*) course and presented to undergrad students enrolled in the GAM114 - Modelagem de Processos Ambientais (*"Environmental Process Modeling"*) course.

The assignment prepared and shared below aims to introduce the *ggplot2* package to the students as a way of plotting simple maps in R. For that we use four packages, as described below:

- *ggplot2*;
- *geobr:* a package that provides spatial data sets of the Brazilian territory;
- *ggspatial:* for plotting basic map items; and
- *RColorBrewer:* for creating color palettes.

# Loading the packages

```{r loading the packages}
library(geobr)
library(ggplot2)
library(ggspatial)
library(RColorBrewer)
```

# Loading data points

As we're plotting the location of air quality monitoring stations, we need to load the data that contains their coordinates. These stations are located in the Espírito Santo state capital, Vitória.

```{r loading the csv}
Stations <- read.csv2(
  file = "Arquivos/Maps/Coordenadas SIRGAS 2000 Completo.csv",
  fileEncoding = "UTF-8")
```

You can obtain this file <a href="Arquivos/Maps/Coordenadas SIRGAS 2000 Completo.csv" download>here</a>.

# The *geobr* package

As stated before, this package is useful to download spatial data sets for the Brazilian country.

## The `list_geobr()` function

This useful function returns the relation between the packages' function, what it returns, the years of available data and the source.

```{r list_geobr}
list_geobr <- list_geobr()
knitr::kable(head(list_geobr))
```
## The `lookup_muni()` function

This useful one helps us track the city's ID. Let's search for Lavras' ID:

```{r lookup_muni}
lookup_muni(name_muni = "LAVRAS")
```

# Downloading the *geobr* data sets

## Country data set

Every time you download a *geobr* data set is useful to plot it to assess if it's the desired one.

```{r estados brasil}
Brazil <- read_country(year = 2020, showProgress = FALSE)
ggplot() + geom_sf(data = Brazil)
```
<br>
As we can see, the upper code returned all the 26 states and the Federal District. But sometimes all you desire is the country's contour lines...

```{r contorno brasil}
Brazil.contour <- read_country(year = 2010, showProgress = FALSE)
ggplot() + geom_sf(data = Brazil.contour)
```
<br>
... To achieve the desired result the solution is changing the *year* argument.

By the way, the first result could be achieved by the following code:

```{r estados brasil 2}
Brazil.states <- read_state(code_state = "all", year = 2020, showProgress = FALSE)
ggplot() + geom_sf(data = Brazil.states)
```
<br>

This page is being built.

```{r eval=FALSE, include=FALSE}
####Instalação/Carregando pacotes e documentos####
#install.packages("geobr")
#install.packages("ggplot2")
#install.packages("ggspatial")
#install.packages("RColorBrewer")

library(geobr)
library(ggplot2)
library(ggspatial)
library(RColorBrewer)

estacao<-read.csv2(
  file = "Coordenadas SIRGAS 2000 Completo.csv")

####O pacote 'geobr'####
#malhas digitais do IBGE e outras plataformas (IPEA)

#Verificando dados disponíveis
?list_geobr
#####
disp<-list_geobr()
#####
#Localizando códigos:
?lookup_muni
#####
lookup_muni(name_muni = "LAVRAS")
#Os dois primeiros dígitos: código do estado
#####
#Obtendo Brasil
?read_country
#####
Brasil<-read_country(year = 2020)
#Usar year = 2010 pra contorno
#ANO é 'sempre' bom informar
#####

#Obtendo estados
?read_state
#####
MG<-read_state(code_state = 31)
ES<-read_state(code_state = "ES")
#####

#Obtendo municípios
?read_municipality
#####
Lavras<-read_municipality(code_muni = 3138203)

lookup_muni(name_muni = "VITORIA")

Vitoria<-read_municipality(code_muni = 3205309)

Serra<-read_municipality(code_muni = 3205002)

Cariacica<-read_municipality(code_muni = 3201308)

VilaVelha<-read_municipality(code_muni = 3205200)

RMV<-rbind(Vitoria,Serra,Cariacica,VilaVelha)
#####

#Obtendo região metropolitana
?read_metro_area
#####
RMet<-read_metro_area()
#####

#Separando RMet por estado
?subset
#####
RMetMG<-subset(RMet, RMet$code_state==31) # ou indexação
#####

####O pacote 'ggplot2'####
#Sintaxe diferente
#nova maneira de criar gráficos a partir dos dados
#conceito de camadas (layers) para a sintaxe do R

#Construindo o primeiro gráfico
?ggplot
?geom_sf

#####
ggplot(data = Brasil)+
  geom_sf()
#####

#Alterando a cor
ggplot(data = Brasil)+
  geom_sf(fill="yellow")

#Adicionando a sigla dos estados
ggplot(data = Brasil)+
  geom_sf(fill="yellow")+
  geom_sf_text(aes(label=abbrev_state))

#Alterando o nome dos eixos
ggplot(data = Brasil)+
  geom_sf(fill="yellow")+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")

#Colorindo só MG
Brasil2<-Brasil
color<-rep(x="transparent",27)
color[17]<-"yellow"
Brasil2$color<-color

ggplot(data = Brasil2)+
  geom_sf(fill=color)+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")

#Temas de gráficos
ggplot(data = Brasil2)+
  geom_sf(fill=color)+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")+
  theme_bw()

ggplot(data = Brasil2)+
  geom_sf(fill=color)+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")+
  theme_classic()

ggplot(data = Brasil2)+
  geom_sf(fill=color)+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")+
  theme_dark()

ggplot(data = Brasil2)+
  geom_sf(fill=color)+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")+
  theme_minimal()

ggplot(data = Brasil2)+
  geom_sf(fill=color)+
  geom_sf_text(aes(label=abbrev_state))+
  labs(x="",y="")+
  theme_void()

#Acrescentando novos elementos
AreaUrbana<-read_urban_area()
VitoriaAU<-subset(AreaUrbana,
                  AreaUrbana$code_muni==3205309)

ggplot()+
  geom_sf(data = VitoriaAU,fill="lightblue")+
  geom_sf(data = Vitoria,size=2,fill="transparent")+
  geom_sf_text(data=Vitoria,aes(
    label=Vitoria$name_muni))+
  coord_sf(xlim=c(-40.37,-40.20),
           ylim=c(-20.35,-20.23))+
  theme_minimal()

#Aula 2
#Para RMV
ggplot()+
  geom_sf(data = AreaUrbana,fill="lightblue")+
  geom_sf(data = RMV,fill="transparent")+
  geom_point(data = estacao,aes(x=long,y=lat,
                                col=Estação))+
  geom_sf_text(data=RMV,aes(label=name_muni))+
  coord_sf(xlim=c(-40.55,-40.15),ylim=c(-20.5,-20))+
  theme_minimal()

#Ajustando tamanho dos pontos e espessura
  #linha das cidades
ggplot()+
  geom_sf(data = AreaUrbana,fill="lightblue")+
  geom_sf(data = RMV,fill="transparent",size=1)+
  geom_point(data = estacao,aes(x=long,y=lat,
                                col=Estação),size=2)+
  geom_sf_text(data=RMV,aes(label=name_muni))+
  coord_sf(xlim=c(-40.55,-40.15),ylim=c(-20.5,-20))+
  theme_minimal()
  
#Adicionando seta
ggplot()+
  geom_sf(data = AreaUrbana,fill="lightblue")+
  geom_sf(data = RMV,fill="transparent",size=1)+
  geom_point(data = estacao,aes(x=long,y=lat,
                                col=Estação),size=2)+
  geom_sf_text(data=RMV,aes(label=name_muni))+
  coord_sf(xlim=c(-40.55,-40.15),ylim=c(-20.5,-20))+
  theme_minimal()+
  annotation_north_arrow(
    style = north_arrow_fancy_orienteering,
    location = "tl") #tl, br,bl

#Adicionando escala
ggplot()+
  geom_sf(data = AreaUrbana,fill="lightblue")+
  geom_sf(data = RMV,fill="transparent",size=1)+
  geom_point(data = estacao,aes(x=long,y=lat,
                                col=Estação),size=2)+
  geom_sf_text(data=RMV,aes(label=name_muni))+
  coord_sf(xlim=c(-40.55,-40.15),ylim=c(-20.5,-20))+
  theme_minimal()+
  annotation_north_arrow(
    style = north_arrow_fancy_orienteering,
                         location = "tr")+
  annotation_scale(location = "br")

#Últimas polidas no mapa

####Pacote RColorBrewer####
display.brewer.all()
display.brewer.all(type = "seq")
display.brewer.all(type = "qual")
display.brewer.all(type = "div")
display.brewer.all(colorblindFriendly = T)
#####

#trocando cor dos pontos
?brewer.pal
#####
display.brewer.pal(9,"Paired")
display.brewer.pal(11,"Paired")
paleta<-brewer.pal(9,"Paired")
paleta2<-brewer.pal(11,"Paired")
#####

ggplot()+
  geom_sf(data = AreaUrbana,fill="lightblue",alpha=0.5,show.legend = T)+
  geom_sf(data = RMV,fill="transparent",size=1)+
  geom_point(data = estacao,aes(x=long,y=lat,col=Estação),size=2)+
  scale_color_manual(values = paleta2[2:10])+
  geom_sf_text(data=RMV,aes(label=name_muni))+
  coord_sf(xlim=c(-40.6,-40.15),ylim=c(-20.55,-20))+
  theme_minimal()+
  annotation_north_arrow(
    style = north_arrow_fancy_orienteering,
    location = "tr")+
  annotation_scale(location = "br")+
  labs(x="",y="",col="")+
  scale_fill_manual(values = c("Area Urbana"="lightblue"))+
  guides(color=guide_legend(override.aes = list(linetype = c(0),fill="transparent")))
  
?ggsave
#####
#plot - objeto que deseja salvar
#filename - nome do arquivo que vai aparecer no PC + extensão do arquivo
#device - a extensão do arquivo
#width - a largura da imagem desejada
#height - a altura da imagem desejada
#units - a unidade de medida dos dois argumentos anteriores
#dpi - aqui vc controla a qualidade/resolução do plot
#####
ggsave(plot = graph,
       filename = "gráfico.png",
       device = "png",
       height = 8.32,
       width = 10.42,
       units = "in",
       dpi = 600)

ggsave(plot = graph,
       filename = "gráfico.tiff",
       device = "tiff",
       height = 8.32,
       width = 10.42,
       units = "in",
       dpi = 600)
```

